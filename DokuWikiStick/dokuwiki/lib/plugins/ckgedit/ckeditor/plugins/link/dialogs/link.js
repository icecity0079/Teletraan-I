var update_ckgeditInternalLink,update_ckgeditMediaLink,fckgInternalInputId,fckgMediaInputId,ckgeditIwikiData,ckgeditIwikiIndex,ck_m_files_protocol,ckg_dialog;window.onbeforeunload=function(){},CKEDITOR.dialog.add("link",function(e){function t(e){return e.replace(/\\'/g,"'")}function i(e){return e.replace(/'/g,"\\$&")}function a(e){var t,a,n,l=O.name,r=O.params;t=[l,"("];for(var o=0;o<r.length;o++)n=e[a=r[o].toLowerCase()],o>0&&t.push(","),t.push("'",n?i(encodeURIComponent(e[a])):"","'");return t.push(")"),t.join("")}function n(e){for(var t,i=e.length,a=[],n=0;n<i;n++)t=e.charCodeAt(n),a.push(t);return"String.fromCharCode("+a.join(",")+")"}oDokuWiki_FCKEditorInstance.Lang=e.lang,ck_m_files_protocol=oDokuWiki_FCKEditorInstance.mfiles?["m-files://‎","m-files://"]:"";var l=oDokuWiki_FCKEditorInstance.dwiki_doku_base,r=CKEDITOR.plugins.link,o=new Object;o.doku_base=new RegExp("^"+l.replace(/\//g,"\\/"),"g"),o.media_internal=/lib\/exe\/fetch\.php\/(.*)/,o.media_rewrite_1=/^_media\/(.*)/,o.media_rewrite_1Doku_Base=new RegExp("^"+l+"_media/(.*)"),o.media_rewrite_2=/exe\/fetch.php\?media=(.*)/,o.internal_link=/doku.php\?id=(.*)/,o.internal_link_rewrite_2=/doku.php\/(.*)/,o.internal_link_rewrite_1=new RegExp("^"+l+"(?!_media)(.*)"),o.samba=/file:\/\/\/\/\/(.*)/,o.interwiki=/^(.*?)oIWIKIo(.*?)cIWIKIc/,o.samba_unsaved=/^\\\\\w+(\\\w.*)/,ckg_dialog=CKEDITOR.dialog;var s,d={InternalLink:"internal link",LinkText:"<span style='font-weight:bold'>Link Display Text</span><br />User defined Text (takes precedence over Page Name or  ID)",InternalMedia:"internal media",LinkPageOrId:"Page Name creates default Dokuwiki Link: <code>[[namespace:page|]]</code><br />ID creates: <code>[[namespace:page|namespace:page]]</code>",MediaFileLink:"link to media file",SMBLabel:"Samba Share",GetHeadingsLabel:"Get Headings",QStringLabel:"Query String (For example: value_1=1&value_2=2) ",ResetQS:"Reset Query String",NotSetOption:"Not Set",AdvancedInfo:"To create anchors from Dokuwiki headers, click on the Get Headings button, select the header, click OK. You can go back, select a new page and get new headers.",AdvancedTabPrompt:"Use the advanced tab to create page anchors and query strings",SMBExample:"Enter your share as: \\\\Server\\directory\\file",InterWikiLink:"Interwiki Link",InterWikiType:"Interwiki Type",InterwikiPlaceHolder:"Interwiki Replacement Text",InterwikiInfo:"<div style='max-width:350px; white-space: pre-wrap;border:1px solid #cccccc; margin:auto; overflow:auto; padding:4px;line-height:125%;'>Dokuwiki's interwiki links are short-cuts which look like this: <span style='font-weight:600'>[[wp&gt;Shakespeare]]</span>, which will create a link to the English Wikipedia article on Shakespeare.  The <span style='font-weight:600'>wp</span> part designates a link pattern;  the text following the '<span style='font-weight:900'>&gt;</span>' will be inserted into the link, replacing  a place holder, which is enclosed in curly brackets, as in <span style='font-weight:600'>{NAME}</span>. When there is no place holder, the replacement text will be appended to the end of the link.</div>",MediaFileLink:"link to media file"},u=e.lang.fbrowser?e.lang.fbrowser:d,c=function(e){return u[e]&&""!=u[e]?u[e]:d[e]};jQuery.ajax({method:"POST",url:DOKU_BASE+"lib/exe/ajax.php",data:{call:"iwiki_list"},async:!0,dataType:"json"}).done(function(e){retv=e,ckgeditIwikiData=retv}).fail(function(e,t,i){alert(t),alert(i)});var p,h=function(e){return jQuery.ajax({method:"POST",url:DOKU_BASE+"lib/exe/ajax.php",data:{dw_id:encodeURIComponent(e),call:call="use_heads"},async:!0,dataType:"html"}).fail(function(e,t,i){alert("Error: "+t+"/"+i)})},m=function(){return s},g=/^javascript:/,f=/^mailto:([^?]+)(?:\?(.+))?$/,k=/subject=([^;?:@&=$,\/]*)/,v=/body=([^;?:@&=$,\/]*)/,I=/^#(.*)$/,y=/^((?:http|https|ftp|news|m-files):\/\/)?(.*)$/,w=/^javascript:void\(location\.href='mailto:'\+String\.fromCharCode\(([^)]+)\)(?:\+'(.*)')?\)$/,b=/^javascript:([^(]+)\(([^)]+)\)$/,_="/"+(l.replace("/","/")+"doku.php?id=(.*)$")+"/",E=function(e,i){var a,n,l,r=i&&(i.data("cke-saved-href")||i.getAttribute("href"))||"",s={};if(r.match(g)&&("encode"==T?r=r.replace(w,function(e,i,a){return"mailto:"+String.fromCharCode.apply(String,i.split(","))+(a&&t(a))}):T&&r.replace(b,function(e,i,a){if(i==O.name){s.type="email";for(var n,l=s.email={},r=/[^,\s]+/g,o=/(^')|('$)/g,d=a.match(r),u=d.length,c=0;c<u;c++)n=decodeURIComponent(t(d[c].replace(o,""))),l[O.params[c].toLowerCase()]=n;l.address=[l.name,l.domain].join("@")}})),!s.type){var d=i?i.getAttribute("class"):"";if(n=r.match(I))s.type="anchor",s.anchor={},s.anchor.name=s.anchor.id=n[1];else if(a=r.match(f)){var u=r.match(k),c=r.match(v);s.type="email";var h=s.email={};h.address=a[1],u&&(h.subject=decodeURIComponent(u[1])),c&&(h.body=decodeURIComponent(c[1]))}else if((l=r.match(o.media_internal))||(l=r.match(o.media_rewrite_1))||(l=r.match(o.media_rewrite_2))||(l=r.match(o.media_rewrite_1Doku_Base)))s.type="media",s.url={},s.url.protocol="",s.url.url="",s.url.selected=l[1];else if((l=r.match(_))||(l=r.match(o.internal_link_rewrite_2))||(l=r.match(o.internal_link_rewrite_1))){s.type="internal",s.url={};var m=l[1].split("=");s.url.selected=m[1],s.url.protocol="",s.url.url=""}else if(l=r.match(o.samba))s.type="samba",s.url={},s.url.url="",s.url.protocol="",s.url.selected="\\\\"+l[1].replace(/\//g,"\\");else if(l=r.match(o.samba_unsaved))s.type="samba",s.url={},s.url.url="",s.url.protocol="",s.url.selected=l[0];else if(l=r.match(o.interwiki)||d.match(/interwiki/)){var E="";l&&l[2]&&(E=decodeURIComponent(l[2])),s.url={},p=i.getAttribute("class");var C=ckg_dialog.getContentElement("info","iwiki_shortcut"),x=C.getInputElement().$.id,S=document.getElementById(x),D=p.match(/iw_([^\s]+)/),L=D[1].replace(/_/,".");if(!E){var K=ckgeditIwikiData[L];K=K.replace(/\{\w+\}$/,"");var R=new RegExp(K+"(.*)");E=(D=r.match(R))[1]}L=ckgeditIwikiIndex[L],S.selectedIndex=L||"0",C.disable(),s.type="interwiki",s.url.selected=E,s.url.url=E}else r&&(l=r.match(y))?(s.type="url",s.url={},s.url.protocol=l[1],s.url.url=l[2]):s.type="url"}if(i){i.getAttribute("target");s.target={},s.adv={}}return this._.selectedElement=i,s};update_ckgeditInternalLink=function(e){e&&(document.getElementById(fckgInternalInputId).disabled=!0,document.getElementById(fckgInternalInputId).style.fontWeight="bold",document.getElementById(fckgInternalInputId).style.backgroundColor="#DDDDDD",e=":"+(e=(e=e.replace(/^[\/\:]/,"")).replace(/\//g,":")),document.getElementById(fckgInternalInputId).value=e)};update_ckgeditMediaLink=function(e){e&&(e=":"+(e=(e=e.replace(/^[\/\:]/,"")).replace(/\//g,":")),document.getElementById(fckgMediaInputId).value=e)};var C=function(e,t){t[e]&&this.setValue(t[e][this.id]||"")},x=function(e){return C.call(this,"adv",e)},S=function(e,t){t[e]||(t[e]={}),t[e][this.id]=this.getValue()||""},D=function(e){return S.call(this,"adv",e)},T=e.config.emailProtection||"";if(T&&"encode"!=T){var O={};T.replace(/^([^(]+)\(([^)]+)\)$/,function(e,t,i){O.name=t,O.params=[],i.replace(/[^,\s]+/g,function(e){O.params.push(e)})})}var L=e.lang.common,K=e.lang.link;return{title:K.title,minWidth:375,minHeight:250,contents:[{id:"info",label:K.info,title:K.info,elements:[{id:"linkType",type:"select",label:K.type,default:"url",items:[[K.toUrl,"url"],[c("InternalLink"),"internal"],[c("InternalMedia"),"media"],[K.toEmail,"email"],[c("SMBLabel"),"samba"],[c("InterWikiLink"),"interwiki"]],onChange:function(){oDokuWiki_FCKEditorInstance.isLocalDwikiBrowser=!1,oDokuWiki_FCKEditorInstance.isUrlExtern=!1,oDokuWiki_FCKEditorInstance.isDwikiMediaFile=!1;var e=this.getDialog(),t=["urlOptions","anchorOptions","emailOptions","internalOptions","mediaOptions","sambaOptions","interwikiOptions"],i=this.getValue(),a=e.definition.getContents("upload"),n=a&&a.hidden;e.hidePage("advanced"),"internal"==i?(oDokuWiki_FCKEditorInstance.isLocalDwikiBrowser=!0,e.showPage("advanced")):"media"==i&&(oDokuWiki_FCKEditorInstance.isDwikiMediaFile=!0),"url"==i?(oDokuWiki_FCKEditorInstance.isUrlExtern=!0,n||e.showPage("upload")):n||e.hidePage("upload");for(var l=0;l<t.length;l++){var r=e.getContentElement("info",t[l]);r&&(r=r.getElement().getParent().getParent(),t[l]==i+"Options"?r.show():r.hide())}e.layout()},setup:function(e){e.type&&this.setValue(e.type)},commit:function(e){e.type=this.getValue()}},{type:"vbox",id:"urlOptions",children:[{type:"hbox",widths:["25%","75%"],children:[{id:"protocol",type:"select",label:L.protocol,default:"http://",items:[["http://‎","http://"],["https://‎","https://"],["ftp://‎","ftp://"],["news://‎","news://"],ck_m_files_protocol],setup:function(e){e.url&&this.setValue(e.url.protocol||"")},commit:function(e){e.url||(e.url={}),e.url.protocol=this.getValue()}},{type:"text",id:"url",label:L.url,required:!0,onLoad:function(){this.allowOnChange=!0},onKeyUp:function(){this.allowOnChange=!1;var e=this.getDialog().getContentElement("info","protocol"),t=this.getValue(),i=/^((javascript:)|[#\/\.\?])/i,a=/^(http|https|ftp|news|m-files):\/\/(?=.)/i.exec(t);a?(this.setValue(t.substr(a[0].length)),e.setValue(a[0].toLowerCase())):i.test(t)&&e.setValue(""),this.allowOnChange=!0},onChange:function(){this.allowOnChange&&this.onKeyUp()},validate:function(){var e=this.getDialog();return!(!e.getContentElement("info","linkType")||"url"==e.getValueOf("info","linkType"))||(!!this.getDialog().fakeObj||CKEDITOR.dialog.validate.notEmpty(K.noUrl).apply(this))},setup:function(e){this.allowOnChange=!1,e.url&&this.setValue(e.url.url),this.allowOnChange=!0},commit:function(e){this.onChange(),e.url||(e.url={}),e.url.url=this.getValue(),this.allowOnChange=!1}}],setup:function(e){this.getDialog().getContentElement("info","linkType")||this.getElement().show()}}]},{type:"vbox",id:"internalOptions",children:[{type:"button",id:"browse1",hidden:"true",filebrowser:"info:url",label:L.browseServer},{type:"text",id:"internal",label:c("InternalLink"),required:!0,setup:function(e){if(e&&e.url&&e.url.selected){var t=e.url.selected.replace(/^\:/,"");this.setValue(":"+t)}}},{type:"text",id:"internal_text",label:c("LinkText"),required:!1},{type:"radio",id:"ilinkstyle",label:c("LinkPageOrId"),items:[["Page Name","page"],["ID","id"]],default:"page",required:!1},{id:"anchorsmsg",type:"html",html:c("AdvancedTabPrompt")}]},{type:"vbox",id:"interwikiOptions",children:[{type:"text",id:"interwiki",label:c("InterwikiPlaceHolder"),required:!0,setup:function(e){if(e&&e.url&&e.url.selected){var t=e.url.selected.replace(/^\:/,"");this.setValue(t)}},commit:function(e){e.url||(e.url={}),e.url.selection=this.getValue()}},{id:"iwiki_shortcut",type:"select",label:c("InterWikiType"),default:"",items:[["Not Set","Not-Set"]],setup:function(e){e.url&&this.setValue(e.url.iwiki_shortcut||"")},commit:function(e){e.url||(e.url={}),e.url.iwiki_shortcut=this.getValue()}},{id:"iwikimsg",type:"html",html:c("InterwikiInfo")}]},{type:"vbox",id:"mediaOptions",children:[{type:"button",id:"browse2",filebrowser:"info:url",label:L.browseServer},{type:"text",id:"media",label:c("MediaFileLink"),required:!0,setup:function(e){if(e&&e.url&&e.url.selected){var t=e.url.selected.replace(/^\:/,"");this.setValue(":"+t)}}}]},{type:"vbox",id:"sambaOptions",children:[{type:"html",id:"smb_msg",html:c("SMBExample")},{type:"text",id:"samba",width:"50",label:c("SMBLabel"),required:!0,setup:function(e){e.url&&e.url.selected&&this.setValue(e.url.selected)}}]},{type:"vbox",id:"emailOptions",padding:1,children:[{type:"text",id:"emailAddress",label:K.emailAddress,required:!0,validate:function(){var e=this.getDialog();return!e.getContentElement("info","linkType")||"email"!=e.getValueOf("info","linkType")||CKEDITOR.dialog.validate.notEmpty(K.noEmail).apply(this)},setup:function(e){e.email&&this.setValue(e.email.address);var t=this.getDialog().getContentElement("info","linkType");t&&"email"==t.getValue()&&this.select()},commit:function(e){e.email||(e.email={}),e.email.address=this.getValue()}},{type:"text",id:"emailSubject",label:K.emailSubject,setup:function(e){e.email&&this.setValue(e.email.subject)},commit:function(e){e.email||(e.email={}),e.email.subject=this.getValue()}},{type:"textarea",id:"emailBody",label:K.emailBody,rows:3,default:"",setup:function(e){e.email&&this.setValue(e.email.body)},commit:function(e){e.email||(e.email={}),e.email.body=this.getValue()}}],setup:function(e){this.getDialog().getContentElement("info","linkType")||this.getElement().hide()}}]},{id:"upload",label:K.upload,title:K.upload,hidden:!0,filebrowser:"uploadButton",elements:[{type:"file",id:"upload",label:L.upload,style:"height:40px",size:29},{type:"fileButton",id:"uploadButton",label:L.uploadSubmit,filebrowser:"info:url",for:["upload","upload"]}]},{id:"advanced",label:K.advanced,title:K.advanced,elements:[{id:"msg",type:"html",html:"<p style='max-width:350px; white-space: pre-wrap;'>"+c("AdvancedInfo")+"</p>"},{id:"internalAnchor",type:"select",default:"",items:[["Not Set",""]],setup:function(e){e.hash&&this.setValue(e.hash)},commit:function(e){e.hash=this.getValue()}},{type:"button",id:"getheaders",onClick:function(){var t=this.getDialog(),i=t.getContentElement("advanced","internalAnchor").getInputElement().$.id,a=document.getElementById(i),n=t.getContentElement("info","internal").getInputElement().$.id;if(n=document.getElementById(n).value){var l={push:function(e,t){this.stack[this.Index]=new Option(e,t,!1,!1),this.Index++},Index:0,stack:void 0,selection:"",ini:function(e){this.stack=a.options,this.stack.length=0,this.Index=0,this.push(e,"")}},r="dw_id="+n;e.config.jquery.post(e.config.ckedit_path+"get_headers.php",r,function(e,t){if("success"==t){var i=decodeURIComponent(e);if(i.match(/^\s*__EMPTY__\s*$/))return l.ini("No Headers Found"),void(l.selection="");l.ini("Headings Menu");var a=i.split("@@");for(var n in a){var r=a[n].split(/;;/);l.push(r[0],r[1])}}},"html")}},label:c("GetHeadingsLabel")},{type:"html",html:"<br />"},{type:"text",id:"queryString",label:c("QStringLabel"),setup:function(e){e.qstring&&this.setValue(e.qstring)},commit:function(e){e.qstring=this.getValue()}},{type:"button",id:"clearquerystring",onClick:function(){var e=this.getDialog().getContentElement("advanced","queryString").getInputElement().$.id;document.getElementById(e).value=""},label:c("ResetQS")},{type:"vbox",padding:1,hidden:!0,children:[{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:K.cssClasses,default:"",id:"advCSSClasses",setup:x,commit:D},{type:"text",label:K.charset,default:"",id:"advCharset",setup:x,commit:D}]}]}]}],onShow:function(){var e=this.getParentEditor(),t=e.getSelection(),i=null;(i=r.getSelectedLink(e))&&i.hasAttribute("href")?t.selectElement(i):i=null,this.setupContent(E.apply(this,[e,i]))},onOk:function(){var e=jQuery.proxy(function(e,t){var l=!1,r=new RegExp(oDokuWiki_FCKEditorInstance.imageUploadAllowedExtensions),o={},s=[],d=!1,u=this.getParentEditor(),c=!1,h="";switch(e.type||"url"){case"media":document.getElementById(fckgMediaInputId).value&&(e.url.url=document.getElementById(fckgMediaInputId).value),e.adv.advTitle=e.url.url;var g=e.url.url.match(/(\.(\w+))$/);h=e.url.url.replace(/^:/,""),e.url.url=top.dokuBase+"doku.php?id="+e.url.url,g[1].match(r)?e.adv.advContentType="linkonly":(e.adv.advContentType="other_mime",e.url.url=top.dokuBase+"lib/exe/fetch.php?media="+h,c=!0),e.adv.advCSSClasses="media mediafile",g&&(e.adv.advCSSClasses+=" mf_"+g[2]);var f=e.url&&void 0!=e.url.protocol?e.url.protocol:"http://",k=e.url&&CKEDITOR.tools.trim(e.url.url)||"";o["data-cke-saved-href"]=0===k.indexOf("/")?k:f+k;break;case"internal":if(l=this.getValueOf("info","internal_text"),ilinkstyle=this.getValueOf("info","ilinkstyle"),!e.url.url&&(e.url.url=document.getElementById(fckgInternalInputId).value,!e.url.url.match(/^:\w+/))){var v=top.getCurrentWikiNS()+":";v=v.replace(/:$/,"");var I=new RegExp(":?"+v+":");e.url.url.match(I)||(e.url.url=v+":"+e.url.url,e.url.url=e.url.url.replace(/\:{2,}/g,":"))}if(e.url.url=e.url.url.replace(/^.*?\/data\/pages\//,""),e.url.url=e.url.url.replace(/^\:/,""),e.url.url=":"+e.url.url.replace(/\//g,":"),e.adv.advCSSClasses="wikilink1",t&&"y"==oDokuWiki_FCKEditorInstance.useheading){var y=t;y.replace(/^:/,"")!=e.url.url.replace(/^:/,"")?(e.adv.advTitle=y,d=!0):d=!1}if("page"!=ilinkstyle||d)d||(e.adv.advTitle=e.url.url);else{var w=e.url.url.split(":");e.adv.advTitle=w.pop()}e.url.url=top.dokuBase+"doku.php?id="+e.url.url,e.hash&&(e.url.url+="#"+e.hash),e.qstring&&(e.url.url+="&"+e.qstring);var f=e.url&&void 0!=e.url.protocol?e.url.protocol:"http://",k=e.url&&CKEDITOR.tools.trim(e.url.url)||"";o["data-cke-saved-href"]=0===k.indexOf("/")?k:f+k;break;case"interwiki":e.adv.advCSSClasses=p||"interwiki iw_"+e.url.iwiki_shortcut;var b=ckgeditIwikiData[e.url.iwiki_shortcut];e.adv.advTitle=e.url.selection,e.url.selection&&(e.url.selection="oIWIKIo"+e.url.selection+"cIWIKIc"),b.match(/\{.*?\}/)?e.url.url=ckgeditIwikiData[e.url.iwiki_shortcut].replace(/{.*?}/,e.url.selection):e.url.url=b+e.url.selection,o["data-cke-saved-href"]=e.url.url;break;case"url":var f=e.url&&void 0!=e.url.protocol?e.url.protocol:"http://",k=e.url&&CKEDITOR.tools.trim(e.url.url)||"";o["data-cke-saved-href"]=0===k.indexOf("/")?k:f+k;break;case"anchor":var _=e.anchor&&e.anchor.name,E=e.anchor&&e.anchor.id;o["data-cke-saved-href"]="#"+(_||E||"");break;case"samba":if(e.url.url||(e.url.url=document.getElementById(m()).value),!e.url.url)return alert("Missing Samba Url"),!1;e.url.protocol="";f="";k=e.url&&CKEDITOR.tools.trim(e.url.url)||"",o["data-cke-saved-href"]=0===k.indexOf("/")?k:f+k,e.adv.advCSSClasses="windows",e.adv.advTitle=e.url.url;break;case"email":var C,x=e.email,S=x.address;switch(T){case"":case"encode":var D=encodeURIComponent(x.subject||""),O=encodeURIComponent(x.body||""),L=[];O&&L.push("body="+O),D&&L.push("subject="+D),L=L.length?"?"+L.join("&"):"","encode"==T?(C=["javascript:void(location.href='mailto:'+",n(S)],L&&C.push("+'",i(L),"'"),C.push(")")):C=["mailto:",S,L];break;default:var K=S.split("@",2);x.name=K[0],x.domain=K[1],C=["javascript:",a(x)]}o["data-cke-saved-href"]=C.join("")}if(e.adv){var R=function(t,i){var a=e.adv[t];a?o[i]=a:s.push(i)};R("advId","id"),R("advLangDir","dir"),R("advAccessKey","accessKey"),e.adv.advName?o.name=o["data-cke-saved-name"]=e.adv.advName:s=s.concat(["data-cke-saved-name","name"]),R("advLangCode","lang"),R("advTabIndex","tabindex"),c||R("advTitle","title"),R("advContentType","type"),R("advCSSClasses","class"),R("advCharset","charset"),R("advStyles","style"),R("advRel","rel")}var V=u.getSelection(),B=!!V.getSelectedText()&&V.getSelectedText();if(o.href=o["data-cke-saved-href"],this._.selectedElement){var j=this._.selectedElement,A=j.data("cke-saved-href"),W=j.getHtml();c&&(o.type="other_mime",o.title=":"+h),j.setAttributes(o),j.removeAttributes(s),e.adv&&e.adv.advName&&CKEDITOR.plugins.link.synAnchorSelector&&j.addClass(j.getChildCount()?"cke_anchor":"cke_anchor_empty"),(A==W||"email"==e.type&&-1!=W.indexOf("@"))&&j.setHtml("email"==e.type?e.email.address:o["data-cke-saved-href"]),V.selectElement(j),delete this._.selectedElement}else{var $=V.getRanges(!0);if(1==$.length&&$[0].collapsed){var M=new CKEDITOR.dom.text("email"==e.type?e.email.address:o["data-cke-saved-href"],u.document);$[0].insertNode(M),$[0].selectNodeContents(M),V.selectRanges($)}if(navigator.userAgent.match(/(Trident|MSIE)/)){var P=u.document.createElement("a");P.setAttribute("href",o.href),B||"media"!=e.type&&"internal"!=e.type?P.setHtml(V.getSelectedText()):l?P.setHtml(l):P.setHtml(e.adv.advTitle);for(attr in o)attr.match(/href/i)||P.setAttribute(attr,o[attr]);u.insertElement(P)}else{var F=new CKEDITOR.style({element:"a",attributes:o});F.type=CKEDITOR.STYLE_INLINE,F.apply(u.document)}}l?M.setText(l):M&&e.adv.advTitle&&M.setText(e.adv.advTitle)},this),t={};this.commitContent(t),"internal"==t.type&&"y"==oDokuWiki_FCKEditorInstance.useheading?jQuery.when(h(function(e){if(!e&&!(e=document.getElementById(fckgInternalInputId).value).match(/^:\w+/)){var t=top.getCurrentWikiNS()+":";t=t.replace(/:$/,"");var i=new RegExp(":?"+t+":");e.match(i)||(e=(e=t+":"+e).replace(/\:{2,}/g,":"))}return e=e.replace(/^.*?\/data\/pages\//,""),e=e.replace(/^\:/,""),e=":"+e.replace(/\//g,":")}(t.url.url)).then(function(i){e(t,i)})):e(t)},onLoad:function(){ckg_iwi_Select_Id_x=this.getContentElement("info","iwiki_shortcut").getInputElement().$.id;var e=function(){if(ckgeditIwikiData){i();var e=document.getElementById(ckg_iwi_Select_Id_x);this.stack=e.options,this.stack.length=0,this.stack[0]=new Option("Not Set","not-set",!1,!1),ckgeditIwikiIndex=new Array;var t=1;for(var a in ckgeditIwikiData)this.stack[t]=new Option(a+" >> "+ckgeditIwikiData[a],a,!1,!1),ckgeditIwikiIndex[a]=t,t++}},t=setInterval(function(){e()},1e3),i=function(){clearInterval(t)};oDokuWiki_FCKEditorInstance.isDwikiImage=!1,fckgInternalInputId=this.getContentElement("info","internal").getInputElement().$.id,fckgMediaInputId=this.getContentElement("info","media").getInputElement().$.id,s=this.getContentElement("info","samba").getInputElement().$.id;this.getContentElement("info","iwiki_shortcut").getInputElement().$.id;this.getContentElement("info","media").disable(),this.hidePage("advanced"),this.showPage("info"),ckg_dialog=this;var a=this._.tabs.advanced&&this._.tabs.advanced[0],n=this,l=c("NotSetOption");a.on("focus",function(e){var t=n.getContentElement("advanced","internalAnchor").getInputElement().$.id,i=document.getElementById(t);i.selectedIndex=-1,i.options.length=0,i.options[0]=new Option(l,"",!1,!1)})},onFocus:function(){var e=this.getContentElement("info","linkType");e&&"url"==e.getValue()&&this.getContentElement("info","url").select()}}});